<%= form_with(model: product, class: "contents") do |form| %>
  <%action = action_name%>
  <% if product.errors.any? %>
    <%action = "new"%>
    <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-lg mt-3">
      <h2><%= pluralize(product.errors.count, "error") %> prohibió a este producto de ser guardado:</h2>

      <ul>
        <% product.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="my-5">
    <%= form.label :nombre %>
    <%= form.text_field :name, class: "block shadow rounded-md border border-gray-200 outline-none px-3 py-2 mt-2 w-full", required: true %>
  </div>

  <div class="my-5">
    <%= form.label :price %>
    <%= form.number_field :price, class: "block shadow rounded-md border border-gray-200 outline-none px-3 py-2 mt-2 w-full", required: true, step: :any %>
  </div>

  <div class="my-5 flex flex-col">
    <%= form.label :stock %>
    <% if action == "new" %>
      <%= form.number_field :stock, class: "block shadow rounded-md border border-gray-200 outline-none px-3 py-2 mt-2 w-full", required: true %>
    <% else %>
      <span class="h-10 borderLeft shadow rounded-md border bg-white -border-l border-gray-200 border-r-gray-500 px-3 py-2 mt-2 w-full"><%= @product.stock %></span>
    <%end%>
  </div>

  <div class="my-8">
    <% if action == "new" %>
      <button class="btn btn-primary" type="submit">Crear Producto</button>
      <%= link_to '❮ Volver', products_path, class: "btn ml-2 rounded-lg py-4 px-5 bg-gray-100 inline-block font-medium text-black hover:text-white" %>
    <% else %>
      <button class="btn btn-primary" type="submit">Actualizar Producto</button>
    <%end%>
  </div>

<%end%>

<script>
  var settings = {
    plugins: {
      'clear_button':{
        'title':'Eliminar todas las opciones seleccionadas',
      },
      remove_button:{
        title:'Remove this item',
      }
    },
    onDelete: function(values) {
      return confirm(values.length > 1 ? 'Are you sure you want to remove these ' + values.length + ' items?' : 'Are you sure you want to remove "' + values[0] + '"?');
    }
  };
  new TomSelect('#categoryselect',settings);
</script>